<!DOCTYPE html>
<html>
<head>
<title>MediTalk Chat</title>
<link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class="app">

    <div class="header">
        ğŸ©º MediTalk â€” AI Medical Assistant
    </div>

 <!-- NAVIGATION PANEL -->
<div class="nav-wrapper">

    <!-- Mobile Dropdown Button -->
    <button class="menu-toggle" onclick="toggleMenu()">â˜° Menu</button>

    <!-- Buttons Container -->
    <div class="nav-panel" id="navMenu">
        <button onclick="quickAsk('Give me general health tips')" class="nav-btn">ğŸ’¡ Health Tips</button>
        <button onclick="quickAsk('List common diseases and their symptoms')" class="nav-btn">ğŸ©º Common Diseases</button>
        <button onclick="quickAsk('Emergency first aid guidance')" class="nav-btn red">ğŸš¨ Emergency</button>
        <button onclick="clearChat()" class="nav-btn clear">ğŸ§¹ Clear Chat</button>
        <button onclick="quickAsk('What can you do?')" class="nav-btn blue">â„¹ï¸ About</button>
    </div>
</div>


    <!-- CHAT -->
    <div id="chat-box" class="chat-box"></div>


    <!-- INPUT -->
  <div class="input-area">
    <textarea id="user-input" placeholder="Type or speak your medical question..."></textarea>

    <div class="input-buttons">
        <button onclick="startVoice()">ğŸ¤ Speak</button>
        <button onclick="sendMessage()">Send</button>

        
    </div>
    <footer class="footer">
        Developed by Tashi Sharma | <a href="https://github.com/tashisharma0201">GitHub</a>| <a href="https://www.linkedin.com/in/tashi-sharma-97695b277/">LinkedIn</a>
    </footer>
</div>





</div>

<script>
loadChat();

function loadChat(){
    fetch("/get_chat").then(res=>res.json()).then(data=>{
        const box=document.getElementById("chat-box");
        box.innerHTML="";
        data.forEach(m=>addMessage(m.sender,m.text));
    });
}
function addMessage(sender,text){
    // remove markdown bold **
    text = text.replace(/\*\*/g, "");

    const box=document.getElementById("chat-box");
    const div=document.createElement("div");
    div.className=`chat ${sender}`;
    div.innerHTML = `<div class="bubble ${sender}-bubble">${text}</div>`;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
}


function sendMessage(){
    const input=document.getElementById("user-input");
    const msg=input.value.trim();
    if(!msg) return;

    addMessage("user",msg);
    input.value="";

    addMessage("bot","Typing... âŒ›");

    fetch("/ask",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({msg})
    }).then(res=>res.json()).then(()=>loadChat());
}

function clearChat(){
    fetch("/clear_chat").then(()=>loadChat());
}

function quickAsk(text){
    document.getElementById("user-input").value=text;
    sendMessage();
}
function toggleMenu(){
    const menu = document.getElementById("navMenu");
    menu.classList.toggle("show-menu");
}

function startVoice(){

    if (!('webkitSpeechRecognition' in window)) {
        alert("Voice input not supported in this browser");
        return;
    }

    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'auto';   // auto-detect language
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.start();

    recognition.onstart = () => {
        document.getElementById("user-input").placeholder = "Listening...";
    };

    recognition.onresult = (event) => {
        const speechText = event.results[0][0].transcript;
        document.getElementById("user-input").value = speechText;
    };

    recognition.onerror = (event) => {
        alert("Voice recognition error: " + event.error);
    };

    recognition.onend = () => {
        document.getElementById("user-input").placeholder =
            "Type or speak your medical question...";
    };
}

</script>

</body>
</html>
